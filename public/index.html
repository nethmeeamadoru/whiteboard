<html>
  <head>
    <style>
      #canvas {
        border: 1px solid black;
      }
    </style>
  </head>
  <body>
    <canvas id="canvas" width="1000" height="500"></canvas>
    <button id="undo-button">Undo</button>
    <button id="redo-button">Redo</button>
    <button id="erase-button">Erase</button>
  </body>
  <script src="https://cdn.jsdelivr.net/npm/@ariutta/svg-pan-zoom@3.7.0/dist/svg-pan-zoom.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.6.0/socket.io.js"></script>
  <script>
    const socket = io();
    const canvas = document.getElementById("canvas");
    const context = canvas.getContext("2d");

    let isDrawing = false;
    let currentPos = { x: 0, y: 0 };
    let lastPos = { x: 0, y: 0 };
    let history = [];
    let historyIndex = 0;

    canvas.addEventListener("mousedown", event => {
        x = event.clientX;
        y = event.clientY;
        isDrawing = true;
      })

    canvas.addEventListener("mouseup", () => {
        isDrawing = false;
        history.splice(historyIndex + 1);
        history.push(context.getImageData(0, 0, canvas.width, canvas.height));
        historyIndex = history.length - 1;
      });

    canvas.addEventListener("mousemove", event => {
      if (!isDrawing) return;

      lastPos = currentPos;
      currentPos = { x: event.clientX, y: event.clientY };

      socket.emit("draw", lastPos, currentPos);

      draw(lastPos, currentPos);
    });

    socket.on("draw", (start, end) => {
      draw(start, end);
    });

    const undoButton = document.getElementById("undo-button");
      undoButton.addEventListener("click", () => {
        if (historyIndex > 0) {
          historyIndex -= 1;
          const imageData = history[historyIndex];
          context.putImageData(imageData, 0, 0);
        }
    });

    const redoButton = document.getElementById("redo-button");
      redoButton.addEventListener("click", () => {
        if (historyIndex < history.length - 1) {
          historyIndex += 1;
          const imageData = history[historyIndex];
          context.putImageData(imageData, 0, 0);
        }
    });

    const eraseButton = document.getElementById("erase-button");
      eraseButton.addEventListener("click", () => {
        context.clearRect(0, 0, canvas.width, canvas.height);
        history.splice(historyIndex + 1);
        history.push(context.getImageData(0, 0, canvas.width, canvas.height));
        historyIndex = history.length - 1;
      });

    function draw(start, end) {
      context.beginPath();
      context.moveTo(start.x, start.y);
      context.lineTo(end.x, end.y);
      context.stroke();
    }
  </script>
</html>
